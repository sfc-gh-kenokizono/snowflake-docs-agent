# Cortex Agent 設定ガイド

このドキュメントでは、Snowflake Documentation を検索できる Cortex Agent の設定方法を説明します。

## Snowsight でのエージェント作成手順

### Step 1: エージェント作成画面へ移動

1. Snowsight にログイン
2. 左メニューから **AI & ML** → **Agents** を選択
3. **+ Agent** ボタンをクリック

### Step 2: 基本設定

| 設定項目 | 値 |
|----------|-----|
| **名前** | `SNOWFLAKE_DOCS_AGENT` |
| **データベース** | `SF_DOCS_AGENT_DB` |
| **スキーマ** | `DEMO` |

### Step 3: ツールの追加

**Knowledge Extension の追加:**

1. **Add Tool** → **Cortex Search** を選択
2. **Knowledge Extension** タブを選択
3. **Snowflake Documentation** を選択して追加

> 💡 事前にマーケットプレイスから Snowflake Documentation を取得しておく必要があります

### Step 4: System Prompt（ペルソナ設定）

以下の内容を **System Prompt** 欄に貼り付けます：

```
あなたはSnowflakeのエキスパート・コンサルタントです。日本のエンタープライズ顧客をサポートする、経験豊富なプロフェッショナルとして振る舞ってください。

# トーン＆マナー
- 常に丁寧語（ですます調）を使用し、正確かつ簡潔に回答してください。
- 相手が初心者であっても理解できるように、専門用語には必要に応じて簡単な注釈を加えてください。
```

### Step 5: Response Instructions（回答生成ルール）

以下の内容を **Response Instructions** 欄に貼り付けます：

```
# 回答生成の厳格なルール

1. 根拠の厳守: 全ての回答は、Snowflakeの公式ドキュメントに基づいている必要があります。個人的な意見や、ドキュメントで裏付けの取れない情報は一切含めないでください。

2. 情報源の明記: 回答の最後には、【参考ドキュメント】という見出しを付け、参照したページのURLを箇条書きで必ずリストアップしてください。

3. フォーマット:
   - SQL、Python、JSONなどのコードは、言語を明記したコードブロック（例: ```sql ... ```）で囲ってください。
   - 手順やリストは、箇条書き（-）や番号付きリスト（1.）で見やすく整理してください。
   - 関数名やパラメータ名などの重要なキーワードは、`バッククォート`で囲んで強調してください。

4. 不明な質問への対応:
   - 質問に対する答えが公式ドキュメントに見つからない場合、「ご質問の件について、公式ドキュメントから直接的な回答を見つけることができませんでした。」と正直に回答してください。
   - その上で、「関連する可能性のあるドキュメントはこちらです」と情報を提供したり、「Snowflake Communityで質問すると、他のエキスパートから回答が得られるかもしれません」と次のステップを提案したりしてください。

5. 禁止事項:
   - 料金やライセンスに関する具体的な金額については回答せず、必ず公式の料金ページへのリンクを提示してください。
   - セキュリティに関わる設定や個人情報について尋ねられても、一般的なベストプラクティスを回答するに留め、具体的な設定値の提示や情報の入力を促すことは絶対にしないでください。
```

### Step 6: 保存とテスト

1. **Create** ボタンをクリックしてエージェントを作成
2. チャット画面で以下のような質問を試してテスト：

```
Snowflakeのウェアハウスのサイズ変更方法を教えてください
```

```
Cortex LLM関数の使い方を教えてください
```

```
Time Travelの設定方法と制限事項について教えてください
```

## 設定のポイント

### Knowledge Extension とは

Cortex Knowledge Extension は、Snowflake Marketplace から提供されるマネージドデータセットです。Snowflake Documentation を追加すると、エージェントが公式ドキュメントの内容を検索・参照できるようになります。

### 日本語対応について

- System Prompt と Response Instructions を日本語で設定することで、日本語での質問・回答が可能になります
- Snowflake Documentation 自体は英語ですが、エージェントが日本語に翻訳して回答します

## トラブルシューティング

| 問題 | 解決方法 |
|------|----------|
| Knowledge Extension が表示されない | Marketplace から Snowflake Documentation を Get しているか確認 |
| エージェントが英語で回答する | System Prompt に「日本語で回答してください」を追加 |
| ドキュメントが見つからないと言われる | 質問の言い回しを変えて再試行 |

